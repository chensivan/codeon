<div id = "codeon-alert-msg"></div>

<div id="theList" ng-controller='ResponsePanelController' class="codeon_panel wrapper">
	<h1 class="title" ng-click="titleClick(title)">
		<span ng-show="selectedObj && responseContent" class="mega-icon icon-chevron-left"></span>
		<span class="title-text">{{selectedObj.request || title}}</span>
	</h1>

	<div class="content-wrapper" >
		<div ng-show="resList" class="request-list">
			<div ng-hide='request.remove' ng-class='request.status.state' class="request-item" ng-class-odd = "'odd'" ng-repeat="request in requests" id="{{request.id}}" ng-click="clickRequest(request)">
				<h2 class='transcript'>Title: {{request.title }} </h2>
				<p class='transcript'>Transcription: {{request.transcript }} </p>
					<div>
						<span class='state'>({{request.notification}})</span>
						<span am-time-ago="request.updated"/>
					</div>
					<div class="request-buttons">
						<button ng-click="playRequest(request); $event.stopPropagation();" class="btn btn-default">
							<span ng-if="!request.playing">
								Play Request
							</span>
							<span ng-if="request.playing">
								Stop
							</span>
						</button>
						<button class="btn btn-default" ng-show='request.removeButton' ng-click="hideRequest(request); $event.stopPropagation();">Remove</button>
				</div>
				</div>

			</div>

			<button class = "btn btn-default" ng-show="resList" id="makeRequest" ng-click="newRequest()"><h2>Make a request</h2></button>


			<div ng-show="selectedObj && responseContent" ng-controller='RequestController' class="request-content">

				<div class='request-info'>
					<h2 class='transcript'>Title: {{selectedObj.title }} </h2>
					<input ng-model="inputs.editedTitle" ng-show="selectedObj.editTitle" class = "native-key-bindings form-control" tabindex="-1"></input>
					<!-- <textarea type="text" ng-model="inputs.iterationMsg" /> -->
					<button class = "btn btn-default" ng-hide="selectedObj.editTitle" ng-click="editTitle(selectedObj)">Edit Title</button>
					<button class = "btn btn-default" ng-show="selectedObj.editTitle" ng-click="changeTitle(inputs.editedTitle, selectedObj)">Done</button>
					<button class = "btn btn-default" ng-show="selectedObj.editTitle" ng-click="cancelTitle(selectedObj)">Cancel</button>

					<p class='transcript'>Transcription: {{selectedObj.transcript }} </p>
					<input ng-model="inputs.editedRequest" ng-show="selectedObj.edit" class = "native-key-bindings form-control" tabindex="-1"></input>
					<!-- <textarea type="text" ng-model="inputs.iterationMsg" /> -->
					<button class = "btn btn-default" ng-hide="selectedObj.edit" ng-click="editRequest(selectedObj)">Edit Transcript</button>
					<button class = "btn btn-default" ng-show="selectedObj.edit" ng-click="changeRequest(inputs.editedRequest, selectedObj)">Done</button>
					<button class = "btn btn-default" ng-show="selectedObj.edit" ng-click="cancelRequest(selectedObj)">Cancel</button>

					<div am-time-ago="selectedObj.updated" />
					<button class = "btn btn-default" ng-click="playRequest(selectedObj); $event.stopPropagation();" class="btn btn-default">
						<span ng-if="!selectedObj.playing">
							Play Request
						</span>
						<span ng-if="selectedObj.playing">
							Stop
						</span>
					</button>
						<!-- <span ng-class='"status " + selectedObj.status.state'>({{selectedObj.notification}})</span> -->
					</div>



					<!-- details of one response  -->
					<div ng-controller='HelperResponse' class="response"  ng-repeat="helper_response in selectedObj.status.responses">

						<!-- add collapse div here -->
						<a href="#" ng-click="collapse(helper_response)">Click to view response. (received <span am-time-ago="helper_response.timestamp"></span>)</a>

						<div ng-show="helper_response.collapse">
							<!-- display each answer in the response -->
							<div ng-repeat="response in helper_response.response" ng-show="response.type">
								<div ng-show='response.type!=="livewriting_logs"' class='response-type'>{{response.type}}</div>
								<p ng-show='(response.type!=="livewriting_logs") && (response.type!=="inlinecode")' class='response-content'>{{response.response}}</p>
								<p ng-class='"merge"' ng-show='response.mergeConflict'>There is a merge conflict with this response. Please resolve it by yourself!</p>
								<button class = "btn btn-default"  ng-show="response.type==='annotation'" ng-click="annotationResponse(response)">Show me!</button>
								<button class = "btn btn-default"  ng-show="response.type==='inlinecode'" ng-click="inlineCodeResponse(response)">
									<span ng-hide="location === 'responseList'" class="icon icon-git-merge"></span>
									{{response.showMerge}}
								</button>
								<div  class="sub-response" ng-repeat="helper_response in selectedObj.status.responses"
								 ng-style="{'background' : bgColor }">
									<div class='response' ng-repeat="response in helper_response.response" ng-show="response.type" ng-if="response.type!='livewriting_logs'">
									</div>
								</div>
							</div>

							<!-- accept, reject and replay buttons -->
							<button class="btn response-button" ng-show="selectedObj" ng-click="merge(selectedObj)">
								<span ng-hide="location === 'responseList'" class="icon icon-git-merge"></span>
								Merge
							</button>
							<button class="btn response-button" ng-show="selectedObj" ng-click="nah()">
								<span ng-hide="location === 'responseList'" class="icon icon-comment-discussion"></span>
								Comment
							</button>
							<button class="btn response-button" ng-show="hasReplay" ng-click="replay(helper_response,response_hash_key)">
								<span ng-hide="location === 'responseList'" class="icon icon-triangle-right"></span>
								Code Replay
							</button>

							<!-- reject action -->
							<div ng-hide="isRejecting" class="reject-controls">
								<textarea ng-model="inputs.iterationMsg" class="form-control native-key-bindings" rows="1" tabIndex = -1  placeholder = "(e.g. javascript event handler syntax)"/>
								<br />
								<button class="btn response-button" ng-click="iterate(inputs.iterationMsg)">
									<span ng-hide="location === 'responseList'" class="icon icon-comment"></span>
									Submit
								</button>
							</div>

							<!-- replay feature -->
							<!--
						<div ng-show="showSlider(response_hash_key)">
								<div class = 'livewriting_navbar'>
									<div id="lw_toolbar{{response_hash_key}}" class="livewriting_navbar_buttons">
										<button id="lw_toolbar_beginning{{response_hash_key}}" class = "lw_toolbar_button">go to beginning</button>
										<button id="lw_toolbar_slower{{response_hash_key}}" class = "lw_toolbar_button">slower</button>
										<button id="lw_toolbar_play{{response_hash_key}}" class = "lw_toolbar_button">pause</button>
										<button id="lw_toolbar_faster{{response_hash_key}}" class = "lw_toolbar_button">faster</button>
										<button id="lw_toolbar_end{{response_hash_key}}" class = "lw_toolbar_button">go to end</button>
										<span id="livewriting_speed{{response_hash_key}}">1</span>&nbsp;X
									</div>
									<div class='livewriting_slider_wrapper'>
										<div id = 'livewriting_slider{{response_hash_key}}' class = 'livewriting_slider'></div>
									</div>
								</div>
							</div>

							<hr>

					  </div>
-->
				  </div>

					<div class='discussion'>
						<h2 ng-show='selectedObj.status.discussion.length>0'>Discussion</h2>
						<div class='row' ng-repeat='iterationRequest in selectedObj.status.discussion'>
							<div class='col-sm-12'>
								<strong am-time-ago="iterationRequest.timestamp"></strong>: {{iterationRequest.message}}
							</div>
						</div>
					</div>

			  </div>

	 		</div>

		</div>
	</div>
</div>
